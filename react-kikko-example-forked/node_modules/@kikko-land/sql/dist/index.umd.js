(function(i,o){typeof exports=="object"&&typeof module!="undefined"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(i=typeof globalThis!="undefined"?globalThis:i||self,o(i.core={}))})(this,function(i){"use strict";const o=Symbol("table"),j=(e,n)=>({name:e,dependsOnTables:n||[],get allDependingTables(){const l=[];return this.dependsOnTables.forEach(u=>{l.push(...u.allDependingTables)}),l},get[o](){return this},__discriminator:"ITableDef"});function d(e){return e===null||typeof e!="object"?!1:Boolean(e[o])}const $=e=>e===null||typeof e=="string"||typeof e=="number"||e instanceof Uint8Array,v=/insert\s+(or\s+\w+\s+)?into\s+/gim,S=/delete\s+from\s+/gim,q=/update\s+(or\s+\w+\s+)?/gim,T=e=>e.replace(/"/g,"").split(".").map(n=>'"'+n+'"').join(".");function y(e){return e===null||typeof e!="object"?!1:"toSql"in e}function E(e,n){if(e.length-1!==n.length)throw e.length===0?new TypeError("Expected at least 1 string"):new TypeError(`Expected ${e.length} strings to have ${e.length-1} values`);const l=n.reduce((s,r)=>s+(y(r)?r.toSql()._values.length:d(r)?0:1),0),u=n.reduce((s,r)=>s+(y(r)?r.toSql().tables.length:d(r)?1:0),0),a=new Array(l),h=new Array(l+1),p=new Array(u);h[0]=e[0];let c=0,_=0;return n.forEach((s,r)=>{const f=n[r],m=e[r+1];if(y(f)){const g=f.toSql();h[c]+=g._strings[0],g._values.forEach((A,b)=>{a[c++]=g._values[b],h[c]=g._strings[b+1]}),g.tables.forEach((A,b)=>{p[_++]=g.tables[b++]}),h[c]+=m}else d(f)?(h[c]+=T(f[o].name)+m,p[_++]=f[o]):(a[c++]=f,h[c]=m)}),{_values:a,_strings:h,tables:p,get isModifyQuery(){const s=this.preparedQuery.text;return s.match(v)!==null||s.match(S)!==null||s.match(q)!==null},get isReadQuery(){return!this.isModifyQuery},get isEmpty(){return this.preparedQuery.text.trim().length===0},get hash(){return this._hash||(this._hash=this._strings.join()+this._values.join()),this._hash},get raw(){return this._strings[0]+this._strings.slice(1).map((s,r)=>(typeof this._values[r]=="string"?"'"+this._values[r]+"'":this._values[r])+s).join("")},get preparedQuery(){return this._cachedText||(this._cachedText=(this._strings[0]+this._strings.slice(1).map((s,r)=>`?${s}`).join("")).trim()),{values:this._values,text:this._cachedText}},inspect(){return{preparedQuery:this.preparedQuery,tables:this.tables}},toSql(){return this},toString(){const{values:s,text:r}=this.preparedQuery;return`${r} - [${s.join(", ")}]`}}}function t(e,...n){return E(e,n)}t.raw=e=>t([e]),t.liter=e=>t.raw(T(e)),t.table=j,t.isTable=d,t.isSql=y,t.empty=t.raw(""),t.join=(e,n=", ",l="",u="")=>{if(e=e.filter(a=>y(a)?!a.toSql().isEmpty:!0),e.length===0)throw new TypeError("Expected `join([])` to be called with an array of multiple elements, but got an empty array");return E([l,...Array(e.length-1).fill(n),u],e)};const w=(e,n,l=!1,u=!1)=>{if(n.length===0)throw new Error("Can't insert empty objects");const a=Object.keys(n[0]),h=t.join(n.map(p=>t`(${t.join(a.map(c=>p[c]))})`));return t`INSERT ${l?t`OR REPLACE`:t.empty} INTO ${t.table(e)} (${t.join(a.map(p=>t.raw(p)))}) VALUES ${h} ${u?t`returning *`:t.empty}`},Q=(e,n)=>{const l=t.join(Object.entries(n).map(([u,a])=>t`${t.raw(u)} = ${a}`));return t`UPDATE ${t.table(e)} SET ${l}`};i.generateInsert=w,i.generateUpdate=Q,i.isPrimitiveValue=$,i.isTable=d,i.sql=t,i.tableSymbol=o,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
