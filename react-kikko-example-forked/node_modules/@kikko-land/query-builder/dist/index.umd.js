(function(i,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("@kikko-land/sql")):typeof define=="function"&&define.amd?define(["exports","@kikko-land/sql"],n):(i=typeof globalThis!="undefined"?globalThis:i||self,n(i.core={},i.sql))})(this,function(i,n){"use strict";var l=(t=>(t.Binary="Binary",t.Unary="Unary",t.Alias="Alias",t.Compound="Compound",t.Select="Select",t.Update="Update",t.Delete="Delete",t.Insert="Insert",t.Values="Values",t.OrderTerm="OrderTerm",t.LimitOffsetTerm="LimitOffsetTerm",t.RawSql="RawSql",t.CompoundOperator="CompoundOperator",t.CTE="CTE",t.Join="Join",t.Returning="Returning",t))(l||{});const h=t=>t!==null&&typeof t=="object"&&"type"in t&&"toSql"in t&&Object.values(l).includes(t.type),f=t=>({type:l.RawSql,toSql(){return n.sql`${t}`}}),s=t=>h(t)?t:(n.sql.isSql(t),f(t)),Y=t=>t!==null&&typeof t=="object"&&"type"in t&&t.type===l.Binary,c=(t,e,r)=>({type:l.Binary,_left:s(e),_right:Array.isArray(r)?r.map(s):s(r),_operator:t,toSql(){return n.sql`${_(this._left)} ${n.sql.raw(this._operator)} ${Array.isArray(this._right)?n.sql`(${n.sql.join(this._right)})`:_(this._right)}`}}),bt=t=>e=>X(e,t),X=(t,e)=>c("<>",t,e),Lt=t=>e=>R(e,t),R=(t,e)=>c("=",t,e),At=t=>e=>z(e,t),z=(t,e)=>c(">",t,e),Bt=t=>e=>Z(e,t),Z=(t,e)=>c(">=",t,e),Ft=t=>e=>Q(e,t),Q=(t,e)=>c("<",t,e),Ct=t=>e=>x(e,t),x=(t,e)=>c("<=",t,e),tt=(t,e)=>c("LIKE",t,e),Ut=t=>e=>tt(e,t),et=(t,e)=>c("NOT LIKE",t,e),Mt=t=>e=>et(e,t),nt=(t,...e)=>c("IN",t,e),it=(t,...e)=>c("NOT IN",t,e),Wt=(...t)=>e=>nt(e,...t),Ht=(...t)=>e=>it(e,...t),p=t=>t.flatMap(e=>h(e)||n.sql.isSql(e)?s(e):Object.entries(e).map(([r,u])=>s(typeof u=="function"?u(n.sql.liter(r)):R(n.sql.liter(r),u)))).filter(e=>!e.toSql().isEmpty),rt=(t,...e)=>{const r=p(e);if(r.length<=1)throw new Error("Must at least two arguments present");let u=c(t,r[0],r[1]);for(const o of r.slice(2))u=c(t,u,o);return u},ut=(...t)=>rt("AND",...t),lt=(...t)=>rt("OR",...t),_=t=>Y(t)&&t._operator==="OR"||h(t)&&(t.type===l.Select||t.type===l.Values)?n.sql`(${t})`:t,y=(t,e)=>({type:l.Alias,_left:s(t),_right:e,toSql(){return n.sql`${_(this._left)} AS ${n.sql.liter(this._right)}`}}),a=(t,e,r)=>({type:l.Join,_operator:t,_toJoin:(()=>{if(typeof e=="string")return n.sql.table(e);if(n.isTable(e))return e;if(h(e)||n.sql.isSql(e))return s(e);{const u=Object.entries(e);if(u.length===0)throw new Error("No alias select present for join");if(u.length>1)throw new Error("Only one select could be specified at join");return{toSelect:s(u[0][1]),alias:u[0][0]}}})(),_on:r,toSql(){const u=(()=>this._operator?"joinType"in this._operator?this._operator.joinType==="CROSS"?[n.sql`CROSS JOIN`]:[this._operator.isNatural?n.sql`NATURAL`:void 0,n.sql.raw(this._operator.joinType),"isOuter"in this._operator&&this._operator.isOuter?n.sql`OUTER`:void 0,n.sql`JOIN`]:[this._operator.isNatural?n.sql`NATURAL`:void 0,n.sql`JOIN`]:[n.sql`JOIN`])().flatMap(o=>o===void 0?[]:o);return n.sql.join([...u,"toSelect"in this._toJoin?y(this._toJoin.toSelect,this._toJoin.alias):_(this._toJoin),...this._on?[n.sql`ON`,...p([this._on])]:[]]," ")}});function I(t,e){return{...this,_joinValues:[...this._joinValues,a(void 0,t,e)]}}function E(t,e){return{...this,_joinValues:[...this._joinValues,a({joinType:"CROSS"},t,e)]}}function g(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0},t,e)]}}function T(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,isOuter:!1,joinType:"LEFT"},t,e)]}}function q(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,isOuter:!1,joinType:"RIGHT"},t,e)]}}function $(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,isOuter:!1,joinType:"FULL"},t,e)]}}function b(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,isOuter:!0,joinType:"LEFT"},t,e)]}}function L(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,isOuter:!0,joinType:"RIGHT"},t,e)]}}function A(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,isOuter:!0,joinType:"FULL"},t,e)]}}function B(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!0,joinType:"INNER"},t,e)]}}function F(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,joinType:"LEFT"},t,e)]}}function C(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,joinType:"RIGHT"},t,e)]}}function U(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,joinType:"FULL"},t,e)]}}function M(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,isOuter:!0,joinType:"LEFT"},t,e)]}}function W(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,isOuter:!0,joinType:"RIGHT"},t,e)]}}function H(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,isOuter:!0,joinType:"FULL"},t,e)]}}function D(t,e){return{...this,_joinValues:[...this._joinValues,a({isNatural:!1,joinType:"INNER"},t),e]}}function J(){return{...this,_joinValues:[]}}const st=(t,e,r)=>({type:l.OrderTerm,_orderType:t,_val:typeof e=="string"?e:s(e),_nullOrder:r,toSql(){return n.sql.join([typeof this._val=="string"?n.sql.liter(this._val):this._val,n.sql.raw(this._orderType),r?n.sql.raw(r):n.sql.empty]," ")}}),Dt=(t,e)=>st("DESC",t,e),Jt=(t,e)=>st("ASC",t,e);function ot(...t){return{...this,_orderByValues:[...this._orderByValues,...t]}}function at(){return{...this,_orderByValue:void 0}}const Pt=t=>({type:l.CTE,_recursive:t.recursive,_values:[{table:t.table,columns:t.columns,select:t.select}],toSql(){return n.sql.join([n.sql`WITH`,this._recursive?n.sql`RECURSIVE`:null,n.sql.join(this._values.map(e=>n.sql`${n.sql.liter(e.table)}(${n.sql.join(e.columns.map(n.sql.liter))}) AS (${e.select})`))].filter(e=>e)," ")}}),ht=(t,e)=>{var r,u;if(((r=t._cteValue)==null?void 0:r._recursive)===!0&&e.recursive===!1)throw new Error("WITH is already recursive");if(((u=t._cteValue)==null?void 0:u._recursive)===!1&&e.recursive===!0)throw new Error("WITH is not recursive");return{...t,_cteValue:t._cteValue?{...t._cteValue,values:[...t._cteValue._values,{}]}:Pt({table:e.table,columns:e.columns,recursive:e.recursive,select:n.sql.isSql(e.select)?f(e.select):e.select})}};function d(t){return ht(this,{...t,recursive:!1})}function O(t){return ht(this,{...t,recursive:!0})}function S(){return{...this,cteValue:void 0}}const N=(...t)=>({type:l.Returning,_values:t.flatMap(e=>n.sql.isSql(e)||h(e)?{_toSelect:s(e)}:typeof e=="string"?{_toSelect:e}:Object.entries(e).map(([r,u])=>typeof u=="string"?{_toSelect:r,_alias:u}:{_toSelect:s(u),_alias:r})),toSql(){return this._values.length>0?n.sql`RETURNING ${n.sql.join(this._values.map(e=>e._toSelect==="*"?n.sql`*`:e._alias?y(e._toSelect,e._alias):e._toSelect))}`:n.sql.empty}});function P(...t){return{...this,_returningValue:{...this._returningValue,_values:[...this._returningValue._values,...N(...t)._values]}}}function G(){return{...this,_returningValue:N()}}const ct=function(t,e,r){const u=t._whereValue?[t._whereValue,...p(r)]:p(r);return u.length>1?{...t,_whereValue:e==="and"?ut(...u):lt(...u)}:{...t,_whereValue:u[0]}};function k(...t){return ct(this,"and",t)}function v(...t){return ct(this,"or",t)}const Gt=t=>({type:l.Delete,_deleteTable:typeof t=="string"?n.sql.table(t):t,_returningValue:N(),with:d,withoutWith:S,withRecursive:O,where:k,orWhere:v,returning:P,withoutReturning:G,toSql(){return n.sql.join([this._cteValue?this._cteValue:null,n.sql`DELETE FROM ${this._deleteTable}`,this._whereValue?n.sql`WHERE ${this._whereValue}`:null,this._returningValue].filter(e=>e)," ")}});function _t(){return{...this,_orReplaceValue:"ABORT"}}function ft(){return{...this,_orReplaceValue:"FAIL"}}function Vt(){return{...this,_orReplaceValue:"IGNORE"}}function jt(){return{...this,_orReplaceValue:"REPLACE"}}function mt(){return{...this,_orReplaceValue:"ROLLBACK"}}const pt=()=>({type:l.LimitOffsetTerm,toSql(){return this._limitValue?n.sql.join([this._limitValue?n.sql`LIMIT ${_(this._limitValue)}`:null,this._offsetValue&&this._limitValue?n.sql`OFFSET ${_(this._offsetValue)}`:null].filter(t=>t)," "):n.sql.empty}});function yt(t){return{...this,_limitOffsetValue:{...this._limitOffsetValue,_limitValue:s(t)}}}function dt(){return{...this,_limitOffsetValue:{...this._limitOffsetValue,_limitValue:void 0}}}function Ot(t){return{...this,_limitOffsetValue:{...this._limitOffsetValue,_offsetValue:s(t)}}}function St(){return{...this,_limitOffsetValue:{...this._limitOffsetValue,_offsetValue:void 0}}}const kt=(...t)=>({type:l.Values,_values:t,_compoundValues:[],_orderByValues:[],_limitOffsetValue:pt(),orderBy:ot,withoutOrder:at,union:Nt,unionAll:wt,intersect:Rt,except:It,withoutCompound:Et,limit:yt,withoutLimit:dt,offset:Ot,withoutOffset:St,withoutWith:S,withRecursive:O,with:d,toSql(){return n.sql.join([this._cteValue?this._cteValue:null,n.sql`VALUES ${n.sql.join(this._values.map(e=>n.sql`(${n.sql.join(e)})`))}`,this._compoundValues.length>0?n.sql.join(this._compoundValues," "):null,this._orderByValues.length>0?n.sql.join([n.sql`ORDER BY`,n.sql.join(this._orderByValues)]," "):null,this._limitOffsetValue.toSql().isEmpty?null:this._limitOffsetValue].filter(e=>e)," ")}}),V=t=>t!==null&&typeof t=="object"&&t.type===l.Values,w=(t,e,r)=>({...t,_compoundValues:[...t._compoundValues,...r.map(u=>{const o=s(u);return{type:l.OrderTerm,_compoundType:e,_value:j(o)||V(o)?o.withoutWith().withoutLimit().withoutOrder().withoutOffset():o,toSql(){return n.sql`${n.sql.raw(this._compoundType)} ${this._value}`}}})]});function Nt(...t){return w(this,"UNION",t)}function wt(...t){return w(this,"UNION ALL",t)}function Rt(...t){return w(this,"INTERSECT",t)}function It(...t){return w(this,"EXCEPT",t)}function Et(){return{...this,_compoundValues:[]}}function gt(...t){return{...this,_fromValues:[...this._fromValues,...t.map(e=>typeof e=="string"?n.sql.table(e):h(e)||n.sql.isSql(e)||n.sql.isTable(e)?s(_(e)):Object.entries(e).map(([r,u])=>({select:typeof u=="string"?n.sql.table(u):s(_(u)),alias:r}))).flat()]}}const Tt=t=>t._fromValues.length>0?n.sql.join(t._fromValues.map(e=>h(e)||n.sql.isTable(e)?e:y(e.select,e.alias))):null,j=t=>t!==null&&typeof t=="object"&&t.type===l.Select,qt=t=>t==null||t.length===0?[{toSelect:"*"}]:t.flatMap((e,r)=>e==="*"&&r===0?{toSelect:"*"}:typeof e=="string"?{toSelect:e}:h(e)||n.sql.isSql(e)?{toSelect:s(e)}:Object.entries(e).map(([u,o])=>typeof o=="string"?{toSelect:u,alias:o}:{toSelect:s(o),alias:u})),vt=(...t)=>({type:l.Select,_fromValues:[],_selectValues:qt(t),_distinctValue:!1,_groupByValues:[],_compoundValues:[],_orderByValues:[],_joinValues:[],_limitOffsetValue:pt(),select(...e){return{...this,_selectValues:[...this._selectValues,...qt(e)]}},distinct(e){return{...this,_distinctValue:e}},from:gt,where:k,orWhere:v,limit:yt,offset:Ot,withoutLimit:dt,withoutOffset:St,groupBy(...e){return{...this,_groupByValues:e.map(r=>typeof r=="string"?r:s(r))}},having(e){return{...this,_havingValue:s(e)}},orderBy:ot,withoutOrder:at,with:d,withoutWith:S,withRecursive:O,union:Nt,unionAll:wt,intersect:Rt,except:It,withoutCompound:Et,withoutJoin:J,join:I,joinCross:E,joinNatural:g,joinLeft:F,joinLeftOuter:M,joinLeftNatural:T,joinLeftNaturalOuter:b,joinRight:C,joinRightOuter:W,joinRightNatural:q,joinRightNaturalOuter:L,joinFull:U,joinFullOuter:H,joinFullNatural:$,joinFullNaturalOuter:A,joinInner:D,joinInnerNatural:B,toSql(){return n.sql.join([this._cteValue?this._cteValue:null,n.sql`SELECT`,this._distinctValue?n.sql`DISTINCT`:null,n.sql.join(this._selectValues.map(e=>e.toSelect==="*"?n.sql`*`:typeof e.toSelect=="string"?n.sql.liter(e.toSelect):e.alias?y(e.toSelect,e.alias):e.toSelect)),this._fromValues.length>0||this._joinValues.length>0?n.sql`FROM`:null,Tt(this),this._joinValues.length>0?n.sql.join(this._joinValues.map(e=>e.toSql())," "):null,this._whereValue?n.sql`WHERE ${this._whereValue}`:null,this._groupByValues.length>0?n.sql`GROUP BY ${n.sql.join(this._groupByValues.map(e=>typeof e=="string"?n.sql.liter(e):e))}`:null,this._groupByValues.length>0&&this._havingValue?n.sql`HAVING ${this._havingValue}`:null,this._compoundValues.length>0?n.sql.join(this._compoundValues," "):null,this._orderByValues.length>0?n.sql.join([n.sql`ORDER BY`,n.sql.join(this._orderByValues)]," "):null,this._limitOffsetValue.toSql().isEmpty?null:this._limitOffsetValue].filter(e=>e)," ")}}),K=t=>(Array.isArray(t)?t:[t]).map(e=>Object.entries(e).map(([r,u])=>({columnName:r,value:n.sql.isSql(u)&&!h(u)?f(u):u}))),Kt=(t,e)=>{if(t._toInsertValue&&(j(t._toInsertValue)||V(t._toInsertValue)))throw new Error("Insert value is already state. If you want to change insert values user resetInsert() before.");return j(e)||V(e)?{...t,_toInsertValue:e}:{...t,_toInsertValue:Array.isArray(t._toInsertValue)?[...t._toInsertValue,...K(e)]:K(e)}},Yt=t=>({type:l.Insert,_returningValue:N(),_columnNames:[],_toInsertValue:j(t)||V(t)?t:K(t),with:d,withRecursive:O,withoutWith:S,orAbort:_t,orFail:ft,orIgnore:Vt,orReplace:jt,orRollback:mt,returning:P,withoutReturning:G,setColumnNames(e){return{...this,_columnNames:e}},withoutColumnNames(){return{...this,_columnNames:[]}},insert(e){return Kt(this,e)},withoutInsert(){return{...this,_toInsertValue:void 0}},into(e){return{...this,_intoTable:typeof e=="string"?n.sql.table(e):e}},withoutInto(){return{...this,_intoTable:void 0}},toSql(){if(!this._toInsertValue)throw new Error("Insert values are not set");if(!this._intoTable)throw new Error("Into table is not set");const e=this._columnNames.length>0?this._columnNames:Array.isArray(this._toInsertValue)?this._toInsertValue[0].map(({columnName:r})=>r):[];return n.sql.join([this._cteValue?this._cteValue:null,n.sql`INSERT`,this._orReplaceValue?n.sql`OR ${n.sql.raw(this._orReplaceValue)}`:null,n.sql`INTO`,this._intoTable,e.length>0?n.sql`(${n.sql.join(e.map(r=>n.sql.liter(r)))})`:null,V(this._toInsertValue)||j(this._toInsertValue)?this._toInsertValue:n.sql`VALUES ${n.sql.join(this._toInsertValue.map(r=>{const u=Array(r.length);for(const{columnName:o,value:m}of r){const $t=e.indexOf(o);if($t===-1)throw new Error(`Column ${o} is not present at columns set: ${e}. Make sure that you set all columns with setColumnNames() or each insert objects have the same keys present. Tried to insert: ${JSON.stringify(r)}`);u[$t]=m}return n.sql`(${n.sql.join(u)})`}))}`,this._returningValue].filter(r=>r)," ")}}),Xt=t=>({type:l.Update,_updateTable:typeof t=="string"?n.sql.table(t):t,_setValues:[],_fromValues:[],_joinValues:[],_returningValue:N(),with:d,withoutWith:S,withRecursive:O,from:gt,where:k,orWhere:v,returning:P,withoutReturning:G,orAbort:_t,orFail:ft,orIgnore:Vt,orReplace:jt,orRollback:mt,withoutJoin:J,join:I,joinCross:E,joinNatural:g,joinLeft:F,joinLeftOuter:M,joinLeftNatural:T,joinLeftNaturalOuter:b,joinRight:C,joinRightOuter:W,joinRightNatural:q,joinRightNaturalOuter:L,joinFull:U,joinFullOuter:H,joinFullNatural:$,joinFullNaturalOuter:A,joinInner:D,joinInnerNatural:B,set(...e){const r=e.flatMap(u=>h(u)?u:n.sql.isSql(u)?f(u):Object.entries(u).map(([o,m])=>({columnName:o,toSet:!h(m)&&n.sql.isSql(m)?f(m):m})));return{...this,_setValues:[...this._setValues,...r]}},toSql(){return n.sql.join([this._cteValue?this._cteValue:null,n.sql`UPDATE`,this._orReplaceValue?n.sql`OR ${n.sql.raw(this._orReplaceValue)}`:null,this._updateTable,n.sql`SET`,n.sql.join(this._setValues.map(e=>h(e)?e:n.sql`${n.sql.liter(e.columnName)} = ${_(e.toSet)}`)),this._fromValues.length>0||this._joinValues.length>0?n.sql`FROM`:null,Tt(this),this._joinValues.length>0?n.sql.join(this._joinValues.map(e=>e.toSql())," "):null,this._whereValue?n.sql`WHERE ${this._whereValue}`:null,this._returningValue].filter(e=>e)," ")}}),zt=t=>({_operator:"NOT",type:l.Unary,_expr:t,toSql(){return n.sql`NOT (${this._expr})`}});i.In=nt,i.alias=y,i.and=ut,i.asc=Jt,i.buildRawSql=f,i.conditionValuesToToken=p,i.deleteFrom=Gt,i.desc=Dt,i.eq=R,i.eq$=Lt,i.gt=z,i.gt$=At,i.gtEq=Z,i.gtEq$=Bt,i.in$=Wt,i.insert=Yt,i.isBinaryOperator=Y,i.isSelect=j,i.isValues=V,i.join=I,i.joinCross=E,i.joinFull=U,i.joinFullNatural=$,i.joinFullNaturalOuter=A,i.joinFullOuter=H,i.joinInner=D,i.joinInnerNatural=B,i.joinLeft=F,i.joinLeftNatural=T,i.joinLeftNaturalOuter=b,i.joinLeftOuter=M,i.joinNatural=g,i.joinRight=C,i.joinRightNatural=q,i.joinRightNaturalOuter=L,i.joinRightOuter=W,i.like=tt,i.like$=Ut,i.lt=Q,i.lt$=Ft,i.ltEq=x,i.ltEq$=Ct,i.not=zt,i.notEq=X,i.notEq$=bt,i.notIn=it,i.notIn$=Ht,i.notLike=et,i.notLike$=Mt,i.or=lt,i.select=vt,i.toToken=s,i.update=Xt,i.values=kt,i.withoutJoin=J,i.wrapParentheses=_,Object.keys(n).forEach(function(t){t!=="default"&&!i.hasOwnProperty(t)&&Object.defineProperty(i,t,{enumerable:!0,get:function(){return n[t]}})}),Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
